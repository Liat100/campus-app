# מדריך בדיקת חיבור למסד נתונים משותף (Vercel KV)

## ✅ שלבים לבדיקה שהאתר מחובר למסד נתונים משותף

### 0. פריסה ל-Vercel (אם עדיין לא עשית)

**⚠️ חשוב:** האתר חייב להיות פרוס ב-Vercel כדי שמשתמשים שונים יראו את אותם נתונים!

אם קיבלת שגיאה `DEPLOYMENT_NOT_FOUND` - הפרויקט לא פרוס. 
**ראה מדריך מפורט ב-`VERCEL_DEPLOYMENT.md`**

---

### 1. בדיקת חיבור למסד נתונים (Database Connection Test)

**⚠️ הערה חשובה:** הבדיקה החשובה ביותר היא פשוט לבדוק בעצמך:
- יוצרת/עורכת קורס בדפדפן אחד
- מרעננת בדפדפן אחר (או במחשב אחר)
- האם השינויים מופיעים? ✅ אם כן - הכל עובד!

---

**אם את רוצה לבדוק את החיבור הטכני:**

יש route מיוחד לבדיקת החיבור:
- **URL**: `/api/db-test`
- **שיטה**: GET request

**איך לבדוק מקומית:**
1. הפעילי את השרת: `npm run dev` בטרמינל
2. פתחי את הדפדפן וגשי ל: `http://localhost:3000/api/db-test`

**איך לבדוק בפרודקשן:**
1. היכנסי ל-Vercel Dashboard → Projects → בחרי את הפרויקט
2. בדף הפרויקט תראי את הדומיין (URL) של האתר, לדוגמה: `campus-app-xyz.vercel.app`
3. פתחי בדפדפן: `https://[הדומיין-שלך].vercel.app/api/db-test`

2. אם הכל תקין, תקבלי תשובה:
   ```json
   {
     "success": true,
     "message": "KV database connection successful",
     "timestamp": "2024-..."
   }
   ```

3. אם יש בעיה, תקבלי שגיאה עם פרטים

---

### 2. הגדרת משתני סביבה ב-Vercel (Production)

כדי שהאתר יעבוד בפרודקשן, צריך להגדיר משתני סביבה ב-Vercel:

**בקונסול Vercel:**
1. היכנסי לפרויקט ב-Vercel Dashboard
2. לכי ל-Settings → Environment Variables
3. הוסיפי את המשתנים הבאים (Vercel אמור ליצור אותם אוטומטית כשמוסיפים KV Store):
   - `KV_URL`
   - `KV_REST_API_URL`
   - `KV_REST_API_TOKEN`
   - `KV_REST_API_READ_ONLY_TOKEN`

**או דרך CLI:**
```bash
vercel env add KV_URL
vercel env add KV_REST_API_URL
vercel env add KV_REST_API_TOKEN
vercel env add KV_REST_API_READ_ONLY_TOKEN
```

---

### 3. בדיקה ששני משתמשים רואים את אותם נתונים ⭐ **הבדיקה החשובה ביותר!**

**בדיקה פשוטה - זו הבדיקה העיקרית:**

**שלב 1:**
1. פתחי את האתר בדפדפן אחד (או במחשב אחד)
2. צרי קורס חדש או ערוכי קורס קיים
3. שמרי את השינויים (לחצי על "שמור")
4. **חשוב:** וודאי שהשמירה הצליחה (אין שגיאות)

**שלב 2:**
1. פתחי את האתר בדפדפן אחר (Chrome Incognito / Edge / Firefox) **או במחשב אחר לחלוטין**
2. רענני את הדף (F5)
3. **בדקי:** האם הקורס שיצרת/ערכת מופיע עם כל השינויים?

**✅ אם כן** - הכל עובד מצוין! האתר משתמש במסד נתונים משותף.

**❌ אם לא** - האתר משתמש ב-localStorage (מקומי לכל מחשב). צריך לבדוק:
- האם האתר פרוס ב-Vercel?
- האם יש KV Store מחובר?
- האם משתני הסביבה מוגדרים?

**אם השינויים לא מופיעים:**
- הבעיה: האפליקציה משתמשת ב-localStorage (מקומי לכל מחשב)
- הפתרון: בדקי שהחיבור ל-KV עובד (שלב 1)

---

### 4. בדיקת Console Logs

פתחי את Developer Tools (F12) ולכי לטאב Console. חפשי:

**אילו הודעות צריכות להופיע:**
- `POST /api/courses: Received X courses to save` - כששומרים
- `POST /api/courses: Successfully saved X courses to KV` - שמירה הצליחה
- `Error fetching courses from API:` - אם יש בעיה בטעינה

**אם רואים שגיאות:**
- `KV connection error` - בעיית חיבור למסד נתונים
- `Failed to fetch courses` - בעיית רשת או חיבור

---

### 5. בדיקה ידנית של הנתונים ב-KV

אם יש לך גישה ל-Vercel Dashboard:

1. לכי ל-KV Store בפרויקט
2. חפשי את המפתח: `campus-courses`
3. בדקי שהנתונים שם מעודכנים

---

## 🔍 פתרון בעיות נפוצות

### בעיה: משתמשים שונים רואים נתונים שונים

**סיבות אפשריות:**
1. **האתר רץ מקומית (localhost)** - כל משתמש רואה את ה-localStorage שלו
   - **פתרון**: הפריסי את האתר ל-Vercel ובדקי שם

2. **משתני סביבה לא מוגדרים**
   - **פתרון**: בדקי שלב 2

3. **החיבור ל-KV לא עובד**
   - **פתרון**: רוצי `/api/db-test` וודאי שהכל תקין

### בעיה: `/api/db-test` מחזיר שגיאה

**אפשרויות:**
1. KV Store לא מחובר לפרויקט ב-Vercel
   - **פתרון**: הוסיפי KV Store דרך Vercel Dashboard

2. משתני סביבה חסרים
   - **פתרון**: הגדירי את משתני הסביבה (שלב 2)

---

## ✅ Checklist סופי

- [ ] `/api/db-test` מחזיר `success: true`
- [ ] האתר פרוס ב-Vercel
- [ ] משתני סביבה מוגדרים ב-Vercel
- [ ] יצרת/ערכת קורס במחשב אחד
- [ ] רעננת בדפדפן אחר/מחשב אחר וראית את השינויים
- [ ] אין שגיאות ב-Console
- [ ] השינויים נשמרים גם אחרי רענון דף

אם כל השלבים עברו בהצלחה - האתר מחובר למסד נתונים משותף! 🎉
